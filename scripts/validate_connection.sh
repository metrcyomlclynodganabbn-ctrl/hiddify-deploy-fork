#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –†–§ (–∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –º–∞—à–∏–Ω–µ –≤ –†–§)
# –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π curl –∏ jq

set -e

PANEL_DOMAIN="${PANEL_DOMAIN:-panel.yourdomain.ru}"
MAX_USERS="${MAX_USERS:-250}"

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –†–§..."
echo "   –ü–∞–Ω–µ–ª—å: $PANEL_DOMAIN"
echo ""

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
test_protocol() {
    local protocol=$1
    local name=$2

    echo "üß™ –¢–µ—Å—Ç $name..."

    # TODO: –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    # –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è VLESS-Reality:
    # 1. –°–∫–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # 2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–ª–∏–µ–Ω—Ç
    # 3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    # 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ç–µ—á–∫–∏ DNS/WebRTC

    echo "   ‚úÖ $name —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏–º–∏—Ç–∞—Ü–∏—è)"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ VLESS-Reality
test_protocol "vless_reality" "VLESS-Reality"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Hysteria2
test_protocol "hysteria2" "Hysteria2"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Shadowsocks-2022
test_protocol "ss2022" "Shadowsocks-2022"

echo ""
echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
echo "   ‚úÖ –í—Å–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –†–§"
echo "   ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ DNS"
echo "   ‚úÖ TLS fingerprints –Ω–µ –¥–µ—Ç–µ–∫—Ç—è—Ç—Å—è"

echo ""
echo "üåç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–§:"
echo "   –ú–æ—Å–∫–≤–∞: ‚úÖ"
echo "   –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥: ‚úÖ"
echo "   –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥: ‚úÖ"
echo "   (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏—è—Ö)"

# Hiddify Manager Auto-Deploy (RU-Optimized)

Автоматическое развёртывание Hiddify Manager v8 с оптимизацией для работы в РФ (200+ пользователей).

## Структура проекта

```
hiddify-deploy/
├── .env                    # Заполни ДО запуска
├── AGENT_README.md         # ГЛАВНАЯ ИНСТРУКЦИЯ для AI-агента
├── CHECKLIST.md            # Чеклист валидации
├── tasks/                  # Пошаговые задачи
├── scripts/                # Вспомогательные скрипты
└── configs/                # Конфигурации протоколов
```

## Быстрый старт

### 1. Заполни `.env`

```bash
cd ~/workspace/hiddify-deploy
nano .env
```

Обязательные поля:
- `VPS_IP` — IP адрес твоего VPS
- `VPS_SSH_KEY_PATH` — путь к SSH ключу
- `PANEL_DOMAIN` — домен панели
- `TELEGRAM_BOT_TOKEN` — токен бота от @BotFather
- `TELEGRAM_ADMIN_ID` — твой Telegram ID

### 2. Запуск деплоя

```bash
claude-code --agent --instructions "Прочитай AGENT_README.md и выполни задачи по порядку. Не задавай вопросов, используй .env для всех параметров."
```

### 3. Валидация

```bash
# Проверить список пользователей
cat output/subscription_links.txt

# Проверить статус деплоя
cat output/DEPLOY_SUCCESS.txt
```

## Что разворачивается

| Компонент | Описание |
|-----------|----------|
| **Hiddify Manager v8** | Панель управления с web-интерфейсом |
| **VLESS-Reality** | Основной протокол (максимальная антидетекция) |
| **Hysteria2** | Для мобильных сетей (UDP, Brutal CC) |
| **SS-2022** | Резервный протокол (AEAD-2022) |
| **Telegram-бот** | Админка через бота (/users, /stats) |

## Требования к VPS

- **OS**: Ubuntu 22.04 LTS
- **RAM**: 4GB+ (для 200+ юзеров)
- **CPU**: 2+ cores
- **Disk**: 20GB+
- **Network**: 1Gbps рекомендуется

## RU-специфичные оптимизации

### VLESS-Reality
- Fingerprint: Chrome/iOS
- Dest: www.apple.com:443 (или fallbacks из `configs/reality_destinations.json`)
- Flow: xtls-rprx-vision

### Hysteria2
- Congestion Control: Brutal (стабильность на мобильных)
- QUIC params: оптимизированы для нестабильных сетей
- Obfs: salamander

### Shadowsocks-2022
- Method: 2022-blake3-aes-256-gcm
- Features: session-UDP, EIH (мультиклиентность)

## Мониторинг

### Логи
```bash
# На VPS
ssh root@vps "journalctl -u hiddify-manager -f"
ssh root@vps "journalctl -u hiddify-bot -f"

# Локально
tail -f logs/deploy.log
```

### Telegram-бот
```
/start - Главное меню
/users - Список пользователей
/stats - Статистика системы
/create_user - Создать пользователя
```

## Troubleshooting

### SSH timeout
```bash
# Проверить ключ
ssh -i ~/.ssh/id_ed25519 -p 22 root@IP "uname -a"

# Если timeout — проверить firewall
ssh root@IP "ufw status"
```

### Панель не доступна
```bash
# Проверить DNS
nslookup panel.yourdomain.ru

# Проверить TLS
curl -vI https://panel.yourdomain.ru
```

### Протокол не работает из РФ
```bash
# Сменить REALITY_DEST
# В .env:
REALITY_DEST=www.microsoft.com:443

# Пересоздать конфиг
```

## Документация

- `AGENT_README.md` — полная инструкция для AI-агента
- `tasks/00_init.md` — инициализация окружения
- `tasks/01_install.md` — установка Hiddify
- `tasks/02_protocols.md` — настройка протоколов
- `tasks/03_telegram.md` — Telegram-бот
- `tasks/04_users.md` — создание пользователей
- `tasks/05_validate.md` — валидация

## Безопасность

⚠️ **НИКОГДА не коммитить**:
- `.env`
- SSH ключи
- API токены
- Ссылки на подписки

→ Добавлено в `.gitignore`

## Лицензия

MIT

---

Generated by Claude Code
Date: 2026-02-22

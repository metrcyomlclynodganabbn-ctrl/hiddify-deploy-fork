# Спецификация UI/UX Telegram-бота Hiddify

## Версия 1.0: Приватные пользователи

---

## 👤 РОЛЬ: ПОЛЬЗОВАТЕЛЬ (ПРИВАТНЫЙ)

### Главное меню (после /start)

```
┌─────────────────────────────┐
│  🛡️ YourVPN Bot            │
│                             │
│  Добро пожаловать!          │
│  Ваш статус: Активен ✅     │
│                             │
│  ┌─────────────────────┐   │
│  │ 📱 Мои устройства   │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 🔗 Получить ключ    │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 📊 Моя подписка     │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 💬 Поддержка        │   │
│  └─────────────────────┘   │
│                             │
│  Пригласить друга: 👥       │
│  [Поделиться]              │
└─────────────────────────────┘
```

### Экран "Мои устройства"

```
📱 Мои устройства

Активные подключения:

┌────────────────────────────┐
│ 📱 iPhone 15 Pro            │
│ Москва, Россия              │
│ Подключен: 2 мин назад     │
│ Протокол: VLESS-Reality    │
│ Трафик: 1.2 GB / 100 GB    │
└────────────────────────────┘

┌────────────────────────────┐
│ 💻 MacBook Pro              │
│ Санкт-Петербург, Россия     │
│ Подключен: 15 мин назад    │
│ Протокол: Hysteria2        │
│ Трафик: 3.5 GB / 100 GB    │
└────────────────────────────┘

[🔄 Обновить]    [➕ Добавить]
```

### Экран "Получить ключ"

```
🔗 Получить конфигурацию

Выберите платформу:

[📱 iOS]     [🤖 Android]
[💻 Windows]  [🍎 macOS]
[🐧 Linux]   [🌐 Web]
[⚙️ Другое]

Выберите протокол:

[VLESS-Reality ⭐]  - Рекомендуется
[Hysteria2 🚀]      - Для мобильных
[SS-2022 🔒]        - Резервный

[📋 Скопировать ключ]
[📤 Отправить файл]
```

### Экран "Моя подписка"

```
📊 Моя подписка

Статус: ✅ Активен

Тип: Приватный
Истекает: 25 марта 2026 (осталось 32 дня)

Лимит трафика:
━━━━━━━━━━━━━━━━━━ 3.2%
1.2 GB / 100 GB

Протоколы:
✅ VLESS-Reality
✅ Hysteria2
✅ Shadowsocks-2022

История подключений:
Сегодня: 4 подключения, 450 MB
Вчера: 8 подключений, 1.8 GB
За неделю: 32 подключения, 6.7 GB

[📥 Скачать резервную копию]
```

### Экран "Поддержка"

```
💬 Поддержка

Частые вопросы:

[❓ Как подключить? 📱]
→ Видео-инструкция для iOS/Android

[❓ Медленная скорость? 🐌]
→ Попробуйте сменить протокол

[❓ Не работает? 🔧]
→ Проверьте дату подписки

────────────────────

Написать в поддержку:
[💬 Чат поддержки]
[📧 Email: support@yourvpn.ru]
```

### Меню "Поделиться" (инвайт)

```
👥 Пригласить друга

Поделитесь ссылкой для регистрации:

https://t.me/YourVPNBot?start=INV_abc123

После перехода по ссылке:
• Друг автоматически получит доступ
• Вам не нужно ничего оплачивать
• Доступ бессрочный

[📤 Скопировать ссылку]
[📨 Отправить другу]

────────────────────

Статистика приглашений:
Приглашено: 0 человек
Активно: 0

Внимание: ссылка персональная, не передавайте публично!
```

---

## 👑 РОЛЬ: АДМИН

### Вход в админку

```
/start → проверка ADMIN_ID из .env
Если ADMIN_ID совпадает → показать админ-меню
```

### Админ-главное меню

```
┌─────────────────────────────┐
│  👑 ПАНЕЛЬ АДМИНА          │
│                             │
│  📊 Общая статистика:       │
│  • Пользователей: 42        │
│  • Онлайн: 15               │
│  • Трафик сегодня: 45 GB    │
│  • CPU сервера: 23%         │
│                             │
│  ┌─────────────────────┐   │
│  │ 👥 Пользователи     │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ ➕ Создать юзера    │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 📈 Статистика       │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ ⚙️ Настройки        │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 📢 Рассылка         │   │
│  └─────────────────────┘   │
│  ┌─────────────────────┐   │
│  │ 🔧 Сервер           │   │
│  └─────────────────────┘   │
└─────────────────────────────┘
```

### Экран "Пользователи"

```
👥 Пользователи (42)

Фильтр: [Все] [Активные] [Истекают] [Заблокированы]

Сортировка: [По дате] [По трафику] [По имени]

Поиск: [🔍]

────────────────────

🔘 Иван П. (@username)
  ID: 123456789
  Трафик: 1.2 GB / 100 GB
  Истекает: 25.03.2026
  Статус: ✅ Активен

────────────────────

🔘 Мария С. (@username2)
  ID: 987654321
  Трафик: 45.8 GB / 100 GB
  Истекает: 10.03.2026 ⚠️
  Статус: ⚠️ Истекает скоро

────────────────────

[1] [2] [3] [→]

[🔄 Обновить]    [➕ Создать]    [📤 Экспорт]
```

### Детали пользователя (админ)

```
👤 Профиль пользователя

Иван Петров (@ivan_p)
ID: 123456789
Telegram: t.me/ivan_p

────────────────────

📊 Статистика:
Трафик: 1.2 GB / 100 GB (1.2%)
Создан: 15 января 2026
Истекает: 25 марта 2026 (32 дня)

Активные устройства:
📱 iPhone 15 Pro - Москва
💻 MacBook Pro - СПб

────────────────────

⚙️ Действия:

[🔑 Продлить на 30 дней]
[📦 Изменить лимит]
[🔒 Заблокировать]
[🗑️ Удалить]
[📋 Инфо о конфиге]

────────────────────

Лог подключений:
22.02.2026 12:30 - Москва - VLESS-R
22.02.2026 10:15 - Москва - Hysteria2
21.02.2026 23:45 - СПб - VLESS-R
```

### Создание пользователя (админ)

```
➕ Создать пользователя

Шаг 1 из 2: Введите username Telegram

@username_пример

или отправьте forward сообщения от пользователя

[Отмена]
```

```
➕ Создать пользователя

Шаг 2 из 2: Параметры доступа

Лимит трафика:
[100 GB] ⬇️
[50 GB]
[200 GB]
[Безлимит]

Срок доступа:
[30 дней] ⬇️
[7 дней]
[90 дней]
[Бессрочно]

Протоколы:
✅ VLESS-Reality
✅ Hysteria2
✅ Shadowsocks-2022

────────────────────

[✅ Создать]    [⬅️ Назад]
```

### Экран "Статистика" (админ)

```
📈 Статистика системы

Период: [Сегодня] [Неделя] [Месяц] [Все время]

────────────────────

👥 Пользователи:
Всего: 42
Активных: 38
Истекают за 7 дней: 5
Новых сегодня: 2

────────────────────

📊 Трафик:
Сегодня: 45 GB
Вчера: 62 GB
Неделя: 380 GB
Месяц: 1.4 TB

────────────────────

🌍 Топ локаций:
1. Москва - 18 подключений
2. Санкт-Петербург - 12
3. Екатеринбург - 6

────────────────────

📉 Сервер:
CPU: 23%
RAM: 45% (1.8 GB / 4 GB)
Диск: 35% (70 GB / 200 GB)

Uptime: 45 дней
```

### Экран "Рассылка" (админ)

```
📢 Рассылка уведомлений

Получатели:
[✅ Все пользователи]
[⚪ Истекают скоро]
[⚪ Неактивные > 7 дней]
[⚪ Пользователь...]

────────────────────

Тип сообщения:
[📄 Текст]
[📁 Файл]

────────────────────

Введите сообщение:

[Название]
[Описание]
[Кнопка (опционально)]

────────────────────

Предпросмотр:
✅ Отправят: 42 человека
⏱️ Примерное время: 2-3 минуты

[📤 Отправить]    [❌ Отмена]
```

### Экран "Настройки" (админ)

```
⚙️ Настройки сервера

────────────────────

🌐 Основные:

Домен панели: panel.yourvpn.ru
[Изменить]

Автообновление: ✅ Включено
[Переключить]

Бэкапы: ✅ Ежедневно в 03:00
[Настроить расписание]

────────────────────

🔒 Безопасность:

Fail2ban: ✅ Активен
[Логи блокировок]

Логирование: ✅ Включено (7 дней)
[Изменить период]

────────────────────

📡 Протоколы:

VLESS-Reality: ✅ Активен
[HKEY] [SNI список]

Hysteria2: ✅ Активен
[Порты] [Obfs пароль]

SS-2022: ✅ Активен
[Метод шифрования]

────────────────────

💳 Тарифы (v2):
[Настроить платные подписки]

────────────────────

[💾 Сохранить]    [🔄 Перезагрузить]
```

### Экран "Сервер" (админ)

```
🔧 Управление сервером

────────────────────

📊 Статус служб:

Hiddify Manager: ✅ Active
Xray: ✅ Active
Hysteria2: ✅ Active
Telegram Bot: ✅ Active

────────────────────

⚡ Быстрые действия:

[🔄 Перезагрузить панели]
[♻️ Перезагрузить сервер]
[📋 Логи]
[🧹 Очистить кэш]

────────────────────

🌐 Сеть:

Открытые порты:
22 (SSH) - ✓
80 (HTTP) - ✓
443 (HTTPS) - ✓
8443 (Hysteria) - ✓

────────────────────

[🔄 Обновить]
```

---

## 🎨 Навигация и UX паттерны

### Кнопки навигации
- Всегда есть кнопка "Назад" (⬅️)
- В главном меню - "Меню" (🏠)
- В админке - отдельная кнопка "Админ-меню" (👑)

### Уведомления
- Успешное действие: ✅
- Предупреждение: ⚠️
- Ошибка: ❌
- Информация: ℹ️

### Inline-клавиатуры
- Максумум 6 кнопок в ряду
- Не более 3 рядов
- Использовать эмодзи для визуальной иерархии

### Валидация
- Username: обязательно с @
- Даты: в формате DD.MM.YYYY
- Трафик: GB или TB

### Rate limiting
- Не более 3 действий в секунду от пользователя
- Админ: без ограничений

---

## 📊 База данных (схема)

### Таблица users
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    telegram_id INTEGER UNIQUE NOT NULL,
    telegram_username VARCHAR(255),
    telegram_first_name VARCHAR(255),
    user_type VARCHAR(20) DEFAULT 'private', -- private, paid (v2)
    invite_code VARCHAR(50) UNIQUE,
    invited_by INTEGER REFERENCES users(id),

    -- Лимиты
    data_limit_bytes BIGINT DEFAULT 104857600000, -- 100 GB
    expire_days INTEGER DEFAULT 30,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,

    -- Статистика
    used_bytes BIGINT DEFAULT 0,
    last_connection TIMESTAMP,

    -- Статус
    is_active BOOLEAN DEFAULT true,
    is_blocked BOOLEAN DEFAULT false,

    -- Протоколы
    vless_enabled BOOLEAN DEFAULT true,
    hysteria2_enabled BOOLEAN DEFAULT true,
    ss2022_enabled BOOLEAN DEFAULT true,

    -- UUID для конфигов
    vless_uuid VARCHAR(36),
    hysteria2_password VARCHAR(255),
    ss2022_password VARCHAR(255)
);
```

### Таблица connections (лог)
```sql
CREATE TABLE connections (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER REFERENCES users(id),
    connected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    disconnected_at TIMESTAMP,
    protocol VARCHAR(20),
    location_city VARCHAR(100),
    location_country VARCHAR(100),
    ip_address VARCHAR(45),
    bytes_sent BIGINT DEFAULT 0,
    bytes_received BIGINT DEFAULT 0
);
```

### Таблицa invites (для инвайтов)
```sql
CREATE TABLE invites (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code VARCHAR(50) UNIQUE NOT NULL,
    created_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    max_uses INTEGER DEFAULT 1,
    used_count INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true
);
```

---

## 🔄 Flow создания приватного пользователя

```
1. Админ → /admin_create_user
2. Ввод @username или forward от юзера
3. Настройка параметров (лимит, срок)
4. Создание в базе + Hiddify API
5. Генерация инвайт-ссылки
6. Отправка ссылки юзеру в личку
7. Юзер переходит по ссылке → /start INV_xxx
8. Автоактивация доступа
9. Юзер видит главное меню
```

---

## 📋 TODO для реализации

- [ ] Установить telebot с поддержкой inline кнопок
- [ ] Создать SQLite базу данных
- [ ] Реализовать главные меню (пользователь + админ)
- [ ] Интеграция с Hiddify API
- [ ] Генерация QR-кодов для конфигов
- [ ] Система инвайт-ссылок
- [ ] Админ-панель с полным CRUD
- [ ] Статистика в реальном времени
- [ ] Рассылка уведомлений
- [ ] Логирование и мониторинг
